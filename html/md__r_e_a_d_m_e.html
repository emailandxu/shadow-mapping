<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Computer Graphics Project: Shadow Mapping in OpenGL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Computer Graphics Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Shadow Mapping in OpenGL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An OpenGL C++ implementation of basic shadow mapping using a depth buffer. </p><center><img src="assets/scene_color.png" alt="Image" class="inline"/></center><p>Implements a two pass rendering algorithm, as described in "Casting Curved Shadows on Curved Surfaces" by Lance Williams, 1978.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
How to run</h1>
<ul>
<li>Only tested on Linux. You may need to do some Windows-specific modifications to compile the project there.</li>
<li>Required libraries:<ul>
<li><code>GL</code></li>
<li><code>GLFW3</code></li>
<li><code>GLEW</code></li>
<li><code>GLM</code></li>
<li><code>ASSIMP</code></li>
</ul>
</li>
<li>Use <code>cmake</code> to build the project: <code>cmake -G "CodeBlocks - Unix Makefiles" /path/to/shadows</code></li>
<li>Run the output executable <code>shadows</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Usage</h1>
<ul>
<li>Left click and drag mouse to move the camera around</li>
<li>Use <code>W</code>/<code>S</code>/<code>A</code>/<code>D</code>/<code>UP</code>/<code>DOWN</code> keys to move the camera forward, horizontally and vertically respectively</li>
<li>Scroll mouse to zoom</li>
<li>Press <code>r</code> to reset the camera</li>
<li><code>q</code> to quit</li>
<li><code>m</code> to toggle depth minimap(s)</li>
<li>Use <code>1</code>..<code>9</code> to toggle the corresponding light</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Algorithm Discussion</h1>
<p>There are two main steps involved in the algorithm. First step, involves creating the shadow map, which takes one pass for each light source. The second step is actually shading and rendering the scene according to the saved shadow maps.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Creating the shadow map</h2>
<p>Consider a single light source in the scene. We create the rendering of the scene from the point of view of this light source. This scene is stored in a depth buffer/depth map as a texture, often called a shadow map, which contains all the visible points for this light. This step can be easily repeated for other light sources in the scene as well, creating separate shadow maps for each light. <br  />
</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Shading the scene</h2>
<p>In the second step, the scene is rendered normally from the point of view of the camera. While doing this, each coordinate in the camera space representing a pixel in the rendered scene is transformed into the light space coordinate system. The resulting z coordinate (after perspective division) is then checked against the previously computed depth buffer value at this xy coordinate to determine if this point lies in the light or in shadow.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Challenges</h2>
<h3><a class="anchor" id="autotoc_md7"></a>
Shadow acne, aka self-shadowing</h3>
<p>Following the original algorithm outlined in the paper, the results were as shown below. </p><center><img src="assets/acne.png" alt="Acne" class="inline"/></center><p>Distinct patterns are visible on the surfaces, as an instance of the well known <a href="https://en.wikipedia.org/wiki/Moir%C3%A9_pattern">Moir√© pattern</a> phenomenon. In theory, the map stores the distance to the closest object from the light; however, due to finite nature of raster graphics, it stores the distances in discrete values. The rendered surfaces are not actually continuous, but rather have jagged texture, with some rows of pixels raised above their neighbours. This causes the surface to shadow <em>itself</em>, since the rows of raised pixels cast a small shadow onto their neighbours, forming bands as seen above.</p>
<p><b>Solution:</b> By understanding that the acne occurs at the surfaces facing towards the light, we can mitigate shadow acne by inserting a small bias value in the depth map comparision calculation. This shifts the perceived depth of all pixels <em>below</em> the surface (away from the light), and the "raised" pixels cannot cast shadows anymore.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Peter panning</h3>
<p>Adding a bias causes another problem, as shown below. </p><center><img src="assets/peter_panning.png" alt="Peter Panning" class="inline"/></center><p>The objects look as if they are "hovering" above the ground, since we shifted the depths away from the light. This is called the "Peter Pan Effect", named after the character who was separated from his shadow. To remedy this, we have to make sure that the bias we use is small enough to not be noticeable. However, using a constant bias value in this case proves to be inadequate for removing acne on curved surfaces where some pixels may still become raised above the surface.</p>
<p><b>Solution:</b> The solution to both these problems is to use a small, but varying bias value dependent on the angle between the normals to the surface and the light direction.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Aliasing</h3>
<p>Looking closely at the edges of the shadows, we see another problem. </p><center><img src="assets/aliasing.png" alt="Peter Panning" class="inline"/></center><p>The shadow edges are extremely jagged, as a consequence of the limited resolution of the depth map we use in the first pass.</p>
<p><b>Solution:</b> There is a rich literature on solving this problem, and here we have implemented Poisson Sampling to reduce aliasing. In the second pass, instead of sampling the depth map only once for each pixel, it's neighbouring pixels in a small circular disc are also sampled. Their depth values also factor into the final visibility value of the pixel, thus allowing for a smooth output.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Results</h2>
<p>The final output is shown below </p><center><img src="assets/scene_screenshot.png" alt="Peter Panning" class="inline"/></center><ul>
<li>We have added support for multiple lights, to allow for more interesting scenarios</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
References</h1>
<ol type="1">
<li><a href="https://dl.acm.org/doi/10.1145/280811.280975">Casting Curved Shadows on Curved Surfaces</a>, Williams, 1978</li>
<li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-16-shadow-mapping/">OpenGL Tutorial</a></li>
<li><a href="https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping">LearnOpenGL</a> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
